<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pennington | Command Center</title>
    <style>
        :root {
            --bg: #1a1a2e; --bg2: #16213e; --card: #2a2a4a; --card2: #1e1e3a;
            --blue: #4a90d9; --green: #44d944; --red: #d94444; --orange: #d9a344; --yellow: #e8c840;
            --text: #e0e0e0; --text2: #999; --text3: #666; --white: #fff;
            --tab-h: 60px;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--bg) 0%, var(--bg2) 100%);
            min-height: 100vh; color: var(--text);
        }
        .tab-content { display: none; padding: 20px 16px; padding-bottom: calc(var(--tab-h) + 30px); max-width: 700px; margin: 0 auto; }
        .tab-content.active { display: block; }

        /* Tab Bar */
        .tab-bar {
            position: fixed; bottom: 0; left: 0; right: 0; height: var(--tab-h);
            background: rgba(22, 33, 62, 0.97); backdrop-filter: blur(10px);
            display: flex; border-top: 1px solid rgba(255,255,255,0.08); z-index: 100;
        }
        .tab-btn {
            flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: none; border: none; color: var(--text3); font-size: 0.65rem;
            cursor: pointer; transition: color 0.2s; gap: 4px; padding-bottom: 4px;
        }
        .tab-btn .tab-icon { font-size: 1.3rem; }
        .tab-btn.active { color: var(--blue); }
        .tab-btn:hover { color: var(--text2); }

        /* Shared */
        .section {
            background: linear-gradient(145deg, var(--card) 0%, var(--card2) 100%);
            border-radius: 14px; padding: 20px; margin-bottom: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
        .section-title {
            font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1.5px;
            color: var(--blue); margin-bottom: 12px; font-weight: 600;
        }
        .badge {
            display: inline-block; padding: 3px 10px; border-radius: 12px;
            font-size: 0.7rem; font-weight: 600; letter-spacing: 0.5px;
        }
        .badge-urgent { background: rgba(217,68,68,0.2); color: var(--red); }
        .badge-high { background: rgba(217,163,68,0.2); color: var(--orange); }
        .badge-medium { background: rgba(232,200,64,0.2); color: var(--yellow); }
        .badge-normal { background: rgba(74,144,217,0.15); color: var(--blue); }

        /* ===== BRIEFING TAB ===== */
        .greeting { text-align: center; margin-bottom: 20px; }
        .greeting h1 { font-size: 1.4rem; color: var(--white); margin-bottom: 6px; }
        .greeting .date { color: var(--text2); font-size: 0.9rem; }
        .phase-badge {
            display: inline-block; background: var(--blue); color: var(--white);
            padding: 4px 14px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; margin-top: 8px;
        }
        .phase-bar { background: rgba(255,255,255,0.08); border-radius: 6px; height: 5px; margin-top: 10px; overflow: hidden; }
        .phase-fill { height: 100%; background: linear-gradient(90deg, var(--blue), var(--green)); border-radius: 6px; transition: width 0.5s; }

        .priority-item {
            display: flex; align-items: flex-start; gap: 10px;
            padding: 9px 0; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 0.95rem;
        }
        .priority-item:last-child { border-bottom: none; }
        .priority-bullet { color: var(--blue); font-weight: 700; flex-shrink: 0; margin-top: 1px; }

        .mantra-text {
            font-size: 1.2rem; color: var(--white); text-align: center;
            font-weight: 600; line-height: 1.5; padding: 8px 0; font-style: italic;
        }
        .principle-book { color: var(--text2); font-size: 0.8rem; margin-bottom: 8px; }
        .principle-text { font-size: 1.05rem; color: var(--white); font-weight: 500; line-height: 1.5; margin-bottom: 10px; }
        .principle-reminder { color: #ccc; font-size: 0.9rem; line-height: 1.5; margin-bottom: 8px; }
        .principle-app { color: var(--blue); font-size: 0.85rem; font-style: italic; line-height: 1.4; }

        .person-card-name { font-size: 1.1rem; color: var(--white); font-weight: 600; margin-bottom: 3px; }
        .person-card-title { color: var(--text2); font-size: 0.85rem; margin-bottom: 10px; }
        .person-card-hook { color: #ccc; font-size: 0.9rem; line-height: 1.4; }
        .person-card-hook strong { color: var(--blue); }

        .todo-item {
            display: flex; align-items: flex-start; gap: 10px;
            padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.05);
            cursor: pointer; transition: opacity 0.2s;
        }
        .todo-item:last-child { border-bottom: none; }
        .todo-check {
            width: 20px; height: 20px; border: 2px solid var(--blue); border-radius: 5px;
            flex-shrink: 0; display: flex; align-items: center; justify-content: center;
            transition: all 0.15s; margin-top: 1px;
        }
        .todo-item.done .todo-check { background: var(--blue); }
        .todo-item.done .todo-check::after { content: '\2713'; color: white; font-size: 13px; }
        .todo-item.done .todo-label { text-decoration: line-through; opacity: 0.5; }
        .todo-label { font-size: 0.9rem; line-height: 1.4; }

        .responsiveness { text-align: center; font-size: 0.9rem; color: #ccc; line-height: 1.7; }
        .responsiveness strong { color: var(--orange); }

        /* ===== FLASHCARDS TAB ===== */
        .fc-header { text-align: center; margin-bottom: 16px; }
        .fc-header h2 { font-size: 1.3rem; color: var(--white); margin-bottom: 8px; }
        .fc-stats { display: flex; justify-content: center; gap: 12px; font-size: 0.8rem; color: var(--text2); margin-bottom: 10px; }
        .fc-stats span { background: rgba(255,255,255,0.1); padding: 4px 10px; border-radius: 14px; }
        .fc-bar { width: 100%; height: 5px; background: rgba(255,255,255,0.08); border-radius: 3px; margin-bottom: 14px; overflow: hidden; }
        .fc-bar-fill { height: 100%; background: linear-gradient(90deg, var(--blue), var(--green)); border-radius: 3px; transition: width 0.3s; }

        .fc-filters { display: flex; flex-wrap: wrap; gap: 6px; justify-content: center; margin-bottom: 10px; }
        .fc-filter-btn {
            background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.15);
            color: var(--text); padding: 6px 12px; border-radius: 16px;
            cursor: pointer; font-size: 0.78rem; transition: all 0.2s;
        }
        .fc-filter-btn:hover { background: rgba(255,255,255,0.15); }
        .fc-filter-btn.active { background: var(--blue); border-color: var(--blue); color: var(--white); }

        .fc-modes { display: flex; gap: 8px; justify-content: center; margin-bottom: 16px; }
        .fc-mode-btn {
            background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.15);
            color: var(--text); padding: 8px 16px; border-radius: 10px;
            cursor: pointer; font-size: 0.85rem; transition: all 0.2s;
        }
        .fc-mode-btn.active { background: var(--blue); border-color: var(--blue); }

        .fc-card-wrap { perspective: 1000px; margin-bottom: 16px; }
        .fc-card {
            background: linear-gradient(145deg, var(--card), var(--card2));
            border-radius: 16px; min-height: 300px; cursor: pointer;
            transition: transform 0.5s; transform-style: preserve-3d;
            position: relative; box-shadow: 0 8px 30px rgba(0,0,0,0.3);
        }
        .fc-card.flipped { transform: rotateY(180deg); }
        .fc-face {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            padding: 24px; backface-visibility: hidden;
            display: flex; flex-direction: column; align-items: center;
            border-radius: 16px;
        }
        .fc-front { background: linear-gradient(145deg, var(--card), var(--card2)); justify-content: center; }
        .fc-back { background: linear-gradient(145deg, #1e3a1e, #1a2e1a); transform: rotateY(180deg); overflow-y: auto; }
        .fc-cat { font-size: 0.7rem; background: rgba(74,144,217,0.3); color: var(--blue); padding: 3px 10px; border-radius: 10px; margin-bottom: 12px; }
        .fc-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1px; color: var(--text3); margin-bottom: 10px; }
        .fc-text { font-size: 1rem; line-height: 1.6; text-align: left; width: 100%; }
        .fc-text ul, .fc-text ol { margin-left: 18px; margin-top: 8px; }
        .fc-text li { margin-bottom: 6px; }
        .fc-text strong { color: var(--blue); }
        .fc-hint { font-size: 0.75rem; color: var(--text3); margin-top: 16px; }

        .fc-controls { display: flex; gap: 10px; justify-content: center; }
        .fc-btn {
            padding: 13px 24px; border: none; border-radius: 12px;
            font-size: 0.95rem; font-weight: 600; cursor: pointer; transition: all 0.2s; color: var(--white);
        }
        .fc-btn-again { background: linear-gradient(145deg, var(--red), #b33636); }
        .fc-btn-good { background: linear-gradient(145deg, var(--green), #36b336); }
        .fc-btn-flip { background: linear-gradient(145deg, var(--blue), #3a7bc8); width: 100%; }
        .fc-btn:hover { transform: translateY(-2px); }
        .fc-empty { text-align: center; padding: 50px 20px; color: var(--text2); }
        .fc-empty h3 { color: var(--green); margin-bottom: 8px; }
        .fc-btn-restart { background: linear-gradient(145deg, var(--blue), #3a7bc8); color: var(--white); margin-top: 16px; }

        /* Sync */
        .sync-row { display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 6px; }
        .sync-code { background: rgba(255,255,255,0.08); padding: 3px 10px; border-radius: 14px; font-size: 0.75rem; color: var(--text2); }
        .sync-change { background: none; border: none; color: var(--blue); cursor: pointer; font-size: 0.75rem; text-decoration: underline; }
        .sync-status { text-align: center; font-size: 0.7rem; color: var(--text2); margin-bottom: 12px; }
        .sync-status.synced { color: var(--green); }
        .sync-status.offline { color: var(--red); }

        /* ===== CONTEXT TAB ===== */
        .ctx-updated { text-align: center; font-size: 0.75rem; color: var(--text3); margin-bottom: 16px; }
        .thread {
            padding: 14px 0; border-bottom: 1px solid rgba(255,255,255,0.06);
        }
        .thread:last-child { border-bottom: none; }
        .thread-header { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; flex-wrap: wrap; }
        .thread-title { font-size: 0.95rem; color: var(--white); font-weight: 600; }
        .thread-summary { font-size: 0.85rem; color: #bbb; line-height: 1.5; }
        .thread-action { font-size: 0.8rem; color: var(--blue); margin-top: 6px; font-style: italic; }

        .ctx-action {
            display: flex; align-items: flex-start; gap: 10px; padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05); cursor: pointer;
        }
        .ctx-action:last-child { border-bottom: none; }
        .ctx-check {
            width: 18px; height: 18px; border: 2px solid var(--blue); border-radius: 4px;
            flex-shrink: 0; display: flex; align-items: center; justify-content: center;
            transition: all 0.15s; margin-top: 2px;
        }
        .ctx-action.done .ctx-check { background: var(--green); border-color: var(--green); }
        .ctx-action.done .ctx-check::after { content: '\2713'; color: white; font-size: 12px; }
        .ctx-action.done .ctx-label { text-decoration: line-through; opacity: 0.4; }
        .ctx-label { font-size: 0.88rem; line-height: 1.4; }

        .watch-item { padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .watch-item:last-child { border-bottom: none; }
        .watch-title { font-size: 0.9rem; color: var(--white); font-weight: 500; margin-bottom: 3px; }
        .watch-desc { font-size: 0.8rem; color: var(--text2); line-height: 1.4; }

        /* ===== PEOPLE TAB ===== */
        .ppl-header { text-align: center; margin-bottom: 16px; }
        .ppl-header h2 { font-size: 1.3rem; color: var(--white); margin-bottom: 8px; }
        .person-photo {
            width: 180px; height: 180px; border-radius: 50%; object-fit: cover;
            border: 4px solid rgba(255,255,255,0.2); margin-bottom: 14px;
        }
        .ppl-name { font-size: 1.4rem; font-weight: 600; color: var(--white); margin-bottom: 6px; text-align: center; }
        .ppl-title { font-size: 0.9rem; color: var(--blue); text-align: center; margin-bottom: 8px; }
        .ppl-cat-badge { font-size: 0.75rem; background: rgba(74,144,217,0.3); color: var(--blue); padding: 3px 10px; border-radius: 10px; }

        /* Modal */
        .modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8); display: flex; align-items: center;
            justify-content: center; z-index: 200; padding: 20px;
        }
        .modal {
            background: linear-gradient(145deg, var(--card), var(--card2));
            border-radius: 16px; padding: 30px; max-width: 380px; width: 100%; text-align: center;
        }
        .modal h2 { color: var(--white); margin-bottom: 12px; }
        .modal p { color: var(--text2); font-size: 0.85rem; margin-bottom: 20px; line-height: 1.5; }
        .modal input {
            width: 100%; padding: 12px; border: 2px solid rgba(255,255,255,0.15);
            border-radius: 10px; background: rgba(255,255,255,0.08); color: var(--white);
            font-size: 1rem; margin-bottom: 16px; text-align: center; outline: none;
        }
        .modal input:focus { border-color: var(--blue); }
        .modal-btn {
            width: 100%; padding: 12px; border: none; border-radius: 10px;
            background: linear-gradient(145deg, var(--blue), #3a7bc8); color: var(--white);
            font-size: 1rem; font-weight: 600; cursor: pointer; margin-bottom: 8px;
        }
        .modal-cancel {
            width: 100%; padding: 10px; background: none; border: 1px solid rgba(255,255,255,0.2);
            border-radius: 10px; color: var(--text2); font-size: 0.85rem; cursor: pointer;
        }

        @media (max-width: 500px) {
            .fc-card { min-height: 260px; }
            .fc-controls { flex-direction: column; }
            .fc-btn { width: 100%; }
            .person-photo { width: 150px; height: 150px; }
        }
    </style>
</head>
<body>

<!-- ==================== BRIEFING TAB ==================== -->
<div id="tab-briefing" class="tab-content active">
    <div class="greeting" id="briefing-header"></div>
    <div id="briefing-sections"></div>
</div>

<!-- ==================== FLASHCARDS TAB ==================== -->
<div id="tab-cards" class="tab-content">
    <div class="fc-header">
        <h2>Flashcards</h2>
        <div class="sync-row">
            <span class="sync-code" id="sync-code-show"></span>
            <button class="sync-change" id="btn-change-sync">Change</button>
        </div>
        <div class="sync-status" id="sync-status">Connecting...</div>
        <div class="fc-stats">
            <span id="fc-mastered">Mastered: 0</span>
            <span id="fc-learning">Learning: 0</span>
            <span id="fc-total">Total: 0</span>
        </div>
    </div>
    <div class="fc-bar"><div class="fc-bar-fill" id="fc-progress"></div></div>
    <div class="fc-modes" id="fc-modes"></div>
    <div class="fc-filters" id="fc-filters"></div>
    <div id="fc-area"></div>
</div>

<!-- ==================== ACTIVE CONTEXT TAB ==================== -->
<div id="tab-context" class="tab-content">
    <div style="text-align:center;margin-bottom:4px;"><h2 style="font-size:1.3rem;color:var(--white);">Active Context</h2></div>
    <div class="ctx-updated" id="ctx-updated"></div>
    <div id="ctx-sections"></div>
</div>

<!-- ==================== PEOPLE TAB ==================== -->
<div id="tab-people" class="tab-content">
    <div class="ppl-header">
        <h2>People Drill</h2>
        <div class="fc-stats">
            <span id="ppl-mastered">Mastered: 0</span>
            <span id="ppl-learning">Learning: 0</span>
            <span id="ppl-total">Total: 41</span>
        </div>
    </div>
    <div class="fc-bar"><div class="fc-bar-fill" id="ppl-progress"></div></div>
    <div class="fc-modes" id="ppl-modes"></div>
    <div class="fc-filters" id="ppl-filters"></div>
    <div id="ppl-area"></div>
</div>

<!-- ==================== TAB BAR ==================== -->
<nav class="tab-bar">
    <button class="tab-btn active" data-tab="briefing"><span class="tab-icon">&#9788;</span><span>Briefing</span></button>
    <button class="tab-btn" data-tab="cards"><span class="tab-icon">&#9827;</span><span>Cards</span></button>
    <button class="tab-btn" data-tab="context"><span class="tab-icon">&#9733;</span><span>Context</span></button>
    <button class="tab-btn" data-tab="people"><span class="tab-icon">&#9786;</span><span>People</span></button>
</nav>

<!-- Sync Modal -->
<div class="modal-overlay" id="sync-modal" style="display:none;">
    <div class="modal">
        <h2>Sync Code</h2>
        <p>Use the same code on all devices to keep flashcard progress in sync.</p>
        <input type="text" id="sync-input" placeholder="e.g., derek-penn" autocomplete="off" autocapitalize="off">
        <button class="modal-btn" id="btn-set-sync">Start</button>
        <button class="modal-cancel" id="btn-cancel-sync">Cancel</button>
    </div>
</div>

<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
import { getFirestore, doc, setDoc, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';

const firebaseConfig = {
    apiKey: "AIzaSyB6XEptBOgnJceezeG91z0Mpug_tQKm3gw",
    authDomain: "pennington-flashcards.firebaseapp.com",
    projectId: "pennington-flashcards",
    storageBucket: "pennington-flashcards.firebasestorage.app",
    messagingSenderId: "812143305002",
    appId: "1:812143305002:web:7fb131c1d503750f78fe53"
};

let db = null;
let unsubscribe = null;
try { db = getFirestore(initializeApp(firebaseConfig)); } catch(e) { console.error('Firebase init failed:', e); }

// ═══════════════════════════════════════
// TAB SWITCHING
// ═══════════════════════════════════════
document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.addEventListener('click', () => {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById('tab-' + btn.dataset.tab).classList.add('active');
        window.scrollTo(0, 0);
    });
});

// ═══════════════════════════════════════
// UTILITIES
// ═══════════════════════════════════════
function esc(s) { const d = document.createElement('div'); d.textContent = s; return d.innerHTML; }
function fmt(t) { return t.replace(/\n/g, '<br>').replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>'); }
function dayOfYear(d) { return Math.floor((d - new Date(d.getFullYear(),0,0)) / 86400000); }
function formatDate(d) {
    const days = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
    const months = ['January','February','March','April','May','June','July','August','September','October','November','December'];
    return days[d.getDay()] + ', ' + months[d.getMonth()] + ' ' + d.getDate() + ', ' + d.getFullYear();
}
const START = new Date('2026-02-02');
function getPhase() {
    const today = new Date(); today.setHours(0,0,0,0);
    const s = new Date(START); s.setHours(0,0,0,0);
    const diff = Math.floor((today - s) / 86400000);
    if (diff < 0) return { name: 'Pre-Start', day: diff, progress: 0 };
    if (diff <= 30) return { name: 'Days 1-30', day: diff, progress: diff / 30 };
    if (diff <= 60) return { name: 'Days 31-60', day: diff, progress: (diff - 30) / 30 };
    if (diff <= 90) return { name: 'Days 61-90', day: diff, progress: (diff - 60) / 30 };
    return { name: 'Post-90', day: diff, progress: 1 };
}

// ═══════════════════════════════════════
// BRIEFING DATA
// ═══════════════════════════════════════
const actionItems = [
    { id: 'ai1', text: 'Circulate email intro to Ryan Warhurst & Gabriel Smith (Warren Everett tax team)', priority: 'high' },
    { id: 'ai2', text: 'Follow up with GTC administrator on missing September statements', priority: 'high' },
    { id: 'ai3', text: 'Complete Avid Bank new user onboarding', priority: 'high' },
    { id: 'ai4', text: 'Get JPM approval level clarified', priority: 'high' },
    { id: 'ai5', text: 'Talk to John about SAS Ventures expenses (Nadia raised before)', priority: 'medium' },
    { id: 'ai6', text: 'Talk to accountant about homebuilder trial balance', priority: 'medium' },
    { id: 'ai7', text: 'Send wire instructions to Avid Bank for pre-clearing', priority: 'high' },
    { id: 'ai8', text: 'Handle Kaufman employment agreement \u2014 Feb pay must be correct', priority: 'urgent' },
    { id: 'ai9', text: 'Review Jake\u2019s rev share process map', priority: 'urgent' },
    { id: 'ai10', text: 'Schedule lunch with Rodd \u2014 relationship building', priority: 'medium' },
];

const principles = {
    1: { book: 'How to Win Friends \u2014 Carnegie', items: [
        { text: "Don\u2019t criticize, condemn, or complain. Give honest, sincere appreciation.", reminder: "Everyone wants to feel important. You can\u2019t win arguments \u2014 even if you win the logic, you lose the person.", app: "Acknowledge good work before corrections. Frame requests in terms of what Brian wants. Begin feedback with praise." },
        { text: "Be genuinely interested in others. Remember names. Listen. Talk about their interests.", reminder: "People support what they help create. The best way to influence someone is to make them feel heard.", app: "In every 1:1, ask about them first. Let leadership feel ownership of changes. Ask questions rather than give orders." },
        { text: "Let the other person feel the idea is theirs. See things from their point of view.", reminder: "A drop of honey catches more flies than a gallon of gall. Show respect for others\u2019 opinions.", app: "When proposing process changes, frame as \u2018what if we tried\u2026\u2019 not \u2018we should.\u2019 Let Brian feel ownership of finance strategy." }
    ]},
    2: { book: 'Amp It Up \u2014 Slootman', items: [
        { text: "Raise your standards. Increase tempo. Sharpen focus.", reminder: "Most orgs operate below potential. Speed is competitive advantage. 2\u20133 focus areas max.", app: "Don\u2019t accept \u2018good enough.\u2019 Compress close cycles. Pick 2\u20133 major initiatives and execute with intensity." },
        { text: "Be a Driver, not a Passenger. Own outcomes end-to-end.", reminder: "Drivers ask \u2018what can I do?\u2019 Passengers watch. Your operating tempo is a choice.", app: "Own problems end-to-end. Don\u2019t wait to be told. You set the standard by what you tolerate." },
        { text: "Declare bankruptcy on broken systems. Don\u2019t polish what\u2019s broken \u2014 redesign it.", reminder: "Intensity wins. The biggest risk isn\u2019t moving too fast, it\u2019s not moving fast enough.", app: "QuickBooks to Sage Intacct isn\u2019t a polish \u2014 it\u2019s a rebuild. Kill legacy approaches that aren\u2019t working." }
    ]},
    3: { book: 'Checklist Manifesto \u2014 Gawande', items: [
        { text: "Complexity exceeds memory. Errors come from ineptitude, not ignorance. Catch the dumb mistakes.", reminder: "Checklists are professionalism, not weakness. Consistent execution beats heroic saves.", app: "Monthly close checklist. Capital calls checklist. Quarterly billing. Fund reporting. After every error, update the checklist." },
        { text: "Good checklists: 5\u20139 items, killer items only, precise wording, tied to workflow pause points.", reminder: "DO-CONFIRM: do from memory, then confirm. READ-DO: read each item, do it.", app: "Define WHEN each checklist runs. New client onboarding. Board/partner reporting." },
        { text: "Checklists free mental bandwidth and force communication at critical moments.", reminder: "They catch the items that get dropped under pressure.", app: "Free your mind for decisions by offloading routine verification. What process made an error? Build a checklist." }
    ]},
    4: { book: 'Power \u2014 Pfeffer', items: [
        { text: "Performance alone doesn\u2019t guarantee success. Power is a learnable skill.", reminder: "Being good is necessary but insufficient. Relationships are strategic assets.", app: "Own financial data. Position yourself in strategy discussions. Be known for delivering decisions, not data dumps." },
        { text: "Build power through: control of resources, structural position, scarcity, visibility.", reminder: "Your sources: financial information dependency, decision-ready recs, process reliability, cross-entity visibility.", app: "Build relationships beyond finance. Speak with confidence. Create scarcity through deep understanding of the full picture." },
        { text: "Power unused atrophies. Early wins establish credibility. Pick battles carefully.", reminder: "Power gaps: new to org, credibility deficit from predecessor, finance seen as back-office.", app: "Deliver what Brian wants before he asks. Fix something visible in first 30 days. Get in the room for strategy." }
    ]},
    5: { book: 'Extreme Ownership \u2014 Willink', items: [
        { text: "Own everything. No excuses, no blaming. There are no bad teams, only bad leaders.", reminder: "If it\u2019s broken, it\u2019s your fault \u2014 which means you can fix it. Blame is the enemy of solutions.", app: "Own outcomes in finance. Accept Brian\u2019s feedback without defensiveness. If the team underperforms, that\u2019s on you." },
        { text: "Prioritize and Execute. Cover and Move. Keep it Simple.", reminder: "When overwhelmed: relax, look around, make a call. If they don\u2019t understand, you haven\u2019t explained well enough.", app: "When close, capital calls, and reporting all hit \u2014 prioritize, execute, next. Finance supports the whole firm." },
        { text: "Discipline Equals Freedom. Lead Up and Down the Chain.", reminder: "If your boss doesn\u2019t give you what you need, you failed to communicate.", app: "SOPs reduce firefighting. Lead up by communicating clearly to Brian. Train team for independent decisions." }
    ]},
    0: { book: 'The Practicing Mind \u2014 Sterner', items: [
        { text: "Focus on process, and the product takes care of itself. Goals are a compass, not a destination.", reminder: "Don\u2019t fixate on \u2018becoming CFO\u2019 \u2014 focus on today\u2019s excellence.", app: "Full attention during close and meetings. Trust the 90-day process. When process IS the goal, nothing to be impatient about." },
        { text: "DOC Method: Do, Observe (without judgment), Correct, Repeat.", reminder: "Non-judgment paradoxically accelerates improvement.", app: "Monthly close: do-observe-correct without self-judgment. When mistakes happen, observe-correct without spiraling." },
        { text: "Four S\u2019s: Simplify, Small, Short, Slow. Single-task. Always practicing something deliberately.", reminder: "Slow is smooth, smooth is fast. The present moment is the only place growth happens.", app: "ERP migration overwhelming? Four S\u2019s. Match Brian\u2019s focused intensity." }
    ]}
};

const mantras = [
    "If it\u2019s not written down, it doesn\u2019t exist.",
    "Checklist first, then execute.",
    "Don\u2019t bring data, bring decisions.",
    "I might make mistakes, but I will never be unresponsive.",
    "Process over product.",
    "Am I being a driver or a passenger?",
    "Error + Immediate Response + Fast Fix = Trust Builder.",
    "You set the standard by what you tolerate.",
    "Intensity wins. Operating tempo is a choice.",
    "Slow is smooth, smooth is fast."
];

const connectPeople = [
    { name: 'Brian Gaister', title: 'CEO', hook: 'Ask what he wants to see from finance this week. Listen for what he values most \u2014 decisions, not data.' },
    { name: 'Rodd Macklin', title: 'Senior MD / Former CFO', hook: 'Ask what worked when he was CFO and what he\u2019d do differently. Nearly 20 years as CFO at PE firms with $2B+ AUM.' },
    { name: 'Guy Scott', title: 'CCO', hook: 'Finance and compliance must be tight. Ask about fee disclosures, Form ADV, regulatory pain points.' },
    { name: 'Taylor Coe', title: 'MD, Real Estate (PREP)', hook: 'New business line \u2014 needs reporting structure clarified. Ask about the RE portfolio and comp model.' },
    { name: 'Alex Rongione', title: 'MD, Real Estate (PREP)', hook: 'CFA, JP Morgan pedigree, $1.7B+ deal experience. Strong analytical mind. Ask about PREP structuring.' },
    { name: 'Wendy Xu', title: 'MD, Private Markets', hook: 'Goldman/Wharton/Princeton. Ask about deal flow and what she needs from finance.' },
    { name: 'Nadia Khan', title: 'Senior Staff Accountant (Your Direct Report)', hook: 'CPA and CFE. Ask what frustrates her, what she enjoys. Your only direct report after John leaves.' },
    { name: 'Kent Andrews', title: 'Partner, Investments', hook: 'Single point of failure for fund info. Ask about GTC fund close backlog. Understand his bottlenecks.' },
    { name: 'John Rizas', title: 'Director of Finance (Transitioning Out)', hook: '12+ years institutional knowledge. Extract everything you can. He\u2019s surprisingly competent \u2014 respect him.' },
    { name: 'Megan Graf', title: 'Senior Operations Advisor', hook: 'SharePoint migration partner. Ask about VAN contract pain points and how she sees ops improving.' },
    { name: 'Chad Lilly', title: 'VP, Head of Talent Acquisition', hook: 'Your internal champion \u2014 likely advocated for your hire. Keep the relationship warm.' },
    { name: 'Megan Bleil', title: 'Partner, Family Office Advisor', hook: 'Founding team (2016). Knows client relationships intimately. Valuable for firm history.' },
    { name: 'Jake Brophy', title: 'Senior Associate, Operations', hook: 'Shared the rev share process map. Key operations ally. Understand his workflow and pain points.' },
    { name: 'Courtney Bates', title: 'Executive Assistant to Brian', hook: 'Brian\u2019s gatekeeper. Respect her time. Getting on Brian\u2019s calendar goes through her.' },
];

// ═══════════════════════════════════════
// BRIEFING RENDER
// ═══════════════════════════════════════
function renderBriefing() {
    const today = new Date();
    const phase = getPhase();
    const dow = today.getDay();
    const doy = dayOfYear(today);

    // Header
    const hour = today.getHours();
    const greeting = hour < 12 ? 'Good morning' : hour < 17 ? 'Good afternoon' : 'Good evening';
    let hdr = `<h1>${greeting}, Derek.</h1>`;
    hdr += `<div class="date">${formatDate(today)}</div>`;
    hdr += `<div style="margin-top:8px"><span class="phase-badge">${phase.name}`;
    if (phase.day >= 0) hdr += ` \u2014 Day ${phase.day}`;
    hdr += `</span></div>`;
    if (phase.day >= 0 && phase.day <= 90) {
        hdr += `<div class="phase-bar"><div class="phase-fill" style="width:${Math.min(phase.progress * 100, 100)}%"></div></div>`;
    }
    document.getElementById('briefing-header').innerHTML = hdr;

    let html = '';

    // Today's priorities (rotate 3-4 from action items based on day)
    const startIdx = (doy * 3) % actionItems.length;
    const todayPriorities = [];
    for (let i = 0; i < 4; i++) {
        todayPriorities.push(actionItems[(startIdx + i) % actionItems.length]);
    }
    html += '<div class="section"><div class="section-title">Today\u2019s Focus</div>';
    todayPriorities.forEach(p => {
        html += `<div class="priority-item"><span class="priority-bullet">\u25B8</span>${esc(p.text)}</div>`;
    });
    html += '</div>';

    // Operating Principle
    const bookDay = (dow === 0 || dow === 6) ? 0 : dow;
    const book = principles[bookDay];
    const pi = doy % book.items.length;
    const pr = book.items[pi];
    html += '<div class="section"><div class="section-title">Operating Principle</div>';
    html += `<div class="principle-book">${book.book}</div>`;
    html += `<div class="principle-text">\u201C${esc(pr.text)}\u201D</div>`;
    html += `<div class="principle-reminder">${esc(pr.reminder)}</div>`;
    html += `<div class="principle-app">${esc(pr.app)}</div></div>`;

    // Mantra
    html += '<div class="section"><div class="section-title">Daily Mantra</div>';
    html += `<div class="mantra-text">\u201C${esc(mantras[doy % mantras.length])}\u201D</div></div>`;

    // Person to connect with
    if (dow === 0 || dow === 6) {
        html += '<div class="section"><div class="section-title">Person to Connect With</div>';
        html += '<div style="text-align:center;color:var(--text2);font-style:italic;padding:8px 0">Weekend \u2014 rest and prepare for next week.</div></div>';
    } else {
        const person = connectPeople[doy % connectPeople.length];
        html += '<div class="section"><div class="section-title">Person to Connect With</div>';
        html += `<div class="person-card-name">${esc(person.name)}</div>`;
        html += `<div class="person-card-title">${esc(person.title)}</div>`;
        html += `<div class="person-card-hook"><strong>Hook:</strong> ${esc(person.hook)}</div></div>`;
    }

    // To-Do (all action items, persistable)
    const todoState = JSON.parse(localStorage.getItem('penn-todo') || '{}');
    html += '<div class="section"><div class="section-title">Action Items</div>';
    actionItems.forEach(item => {
        const done = todoState[item.id] || false;
        html += `<div class="todo-item ${done ? 'done' : ''}" data-todo="${item.id}">`;
        html += `<div class="todo-check"></div>`;
        html += `<div class="todo-label">${esc(item.text)}</div></div>`;
    });
    html += '</div>';

    // Responsiveness
    html += '<div class="section"><div class="section-title">Responsiveness</div>';
    html += '<div class="responsiveness"><strong>Acknowledge within 1 hour.</strong><br>';
    html += '<strong>Report errors within 30 minutes.</strong><br>';
    html += '<strong>Close every loop.</strong></div></div>';

    document.getElementById('briefing-sections').innerHTML = html;

    // Todo click handlers
    document.querySelectorAll('.todo-item').forEach(el => {
        el.addEventListener('click', () => {
            const id = el.dataset.todo;
            const state = JSON.parse(localStorage.getItem('penn-todo') || '{}');
            state[id] = !state[id];
            localStorage.setItem('penn-todo', JSON.stringify(state));
            el.classList.toggle('done');
        });
    });
}

// ═══════════════════════════════════════
// ACTIVE CONTEXT DATA & RENDER
// ═══════════════════════════════════════
const liveThreads = [
    { title: 'Revenue Share Fix', urgency: 'urgent', tags: ['BRIAN SENSITIVE'],
      summary: 'Last cycle very delayed, Brian was furious. Current flow: Orion billing \u2192 rev share calc (failed in Orion) \u2192 Excel. Jake shared process map.',
      action: 'Review Jake\u2019s process map. Build \u201Cworld-class\u201D rev share file.' },
    { title: 'RE Team Comp Model', urgency: 'urgent', tags: ['BRIAN ASK'],
      summary: 'Brian wants a model showing Taylor Coe and Alex Rongione projected comp (cash + deferred carry scenarios). Deliver a decision-ready recommendation, not just a spreadsheet.',
      action: 'Get back to Brian with analysis.' },
    { title: 'GTC Fund Close Backlog', urgency: 'urgent', tags: [],
      summary: 'September not yet issued. Missing statements from GTC administrator. Kent reviewing but way behind \u2014 he\u2019s the bottleneck.',
      action: 'Follow up with GTC admin on missing statements. Get admins on distribution lists.' },
    { title: 'First Close (SAS Ventures)', urgency: 'high', tags: [],
      summary: 'Working with David Bell on legal/subscription docs. Need to understand capital call mechanics (expenses, inside vs outside commitment).',
      action: 'Wire instructions need pre-clearing with Avid Bank.' },
    { title: 'Kaufman Employment Agreement', urgency: 'high', tags: [],
      summary: 'Salary going up, redline doc needed. Must get Feb pay correct, then adjust in ADP going forward. Payroll every other Friday.',
      action: 'Handle before next payroll cycle.' },
    { title: 'System Access (Blocking)', urgency: 'high', tags: [],
      summary: 'Avid Bank (John sent new user), JPM (need approval level), compliance account (linking issues). Tracking in 30/60/90.',
      action: 'Complete Avid Bank onboarding. Clarify JPM access.' },
    { title: 'Manage Up to Brian', urgency: 'high', tags: ['SELF-FLAGGED'],
      summary: 'Not talking to Brian enough. \u201CA little scared of him.\u201D Zero tolerance for errors + micromanagement = high-quality, proactive communication mandatory.',
      action: 'Proactively reach out. Decisions, not data.' },
    { title: 'John Rizas Dynamic', urgency: 'medium', tags: [],
      summary: 'Staying as Director with performance milestones. Navigate carefully. Rodd\u2019s plan: Day 15 cash, Day 30 auditor/tax, Day 60 full realignment. He\u2019s competent and detail-oriented.',
      action: 'Respect him. Learn from him. Follow Rodd\u2019s timeline.' },
    { title: 'QuickBooks Reporting Project', urgency: 'medium', tags: [],
      summary: 'Auto-extracting BS, IS, cash flow for consolidated view. Balance sheet is a mess. Goal: seamless reporting for Avid Bank line of credit.',
      action: 'Understand current state. Plan the cleanup.' },
    { title: 'SBA Loan Subordination', urgency: 'medium', tags: [],
      summary: 'Need Covid SBA loan subordinated to Avid Bank loan. John working on it but stuck in SBA bureaucracy.',
      action: 'Track and escalate if needed.' },
    { title: 'SharePoint Migration', urgency: 'medium', tags: [],
      summary: 'Working with Megan Graf. Files on VAN-hosted V: drive (hard to search). Plan: push to SharePoint with metadata tagging. Nobody happy with VAN.',
      action: 'Meeting with VAN coming up.' },
    { title: 'Institutionalize Kent', urgency: 'medium', tags: [],
      summary: 'Too much runs through Kent\u2019s personal email/phone. Single point of failure. Goal: move to distribution lists, shared systems, documented workflows.',
      action: 'Related to GTC backlog \u2014 Kent is the bottleneck.' },
    { title: '30/60/90 Execution', urgency: 'normal', tags: [],
      summary: 'Plan updated with Rodd\u2019s input + context dump. Now concrete and Pennington-specific. Week 2 in progress.',
      action: 'Review weekly with Brian.' },
];

const ctxActionItems = [
    { id: 'ca1', text: 'Circulate email intro to Ryan Warhurst & Gabriel Smith (Warren Everett tax team \u2014 SAS/Paddington funds)' },
    { id: 'ca2', text: 'Follow up with GTC administrator on missing statements' },
    { id: 'ca3', text: 'Complete Avid Bank new user onboarding' },
    { id: 'ca4', text: 'Get JPM approval level clarified' },
    { id: 'ca5', text: 'Talk to John about SAS Ventures expenses (Nadia raised before)' },
    { id: 'ca6', text: 'Talk to accountant about homebuilder trial balance (no context yet)' },
    { id: 'ca7', text: 'Send wire instructions to Avid Bank for pre-clearing' },
    { id: 'ca8', text: 'Handle Kaufman employment agreement \u2014 Feb pay must be correct' },
    { id: 'ca9', text: 'Review Jake\u2019s rev share process map' },
    { id: 'ca10', text: 'Schedule lunch with Rodd \u2014 relationship building, tap his tax/institutional knowledge' },
];

const watchingItems = [
    { title: 'ERP Migration (Sage Intacct)', desc: 'Buy-in exists, execution hasn\u2019t started. Day 61\u201390 initiative. QB Online + Desktop \u2192 enterprise with intercompany.' },
    { title: 'Vendor Management (Posa)', desc: 'Tool exists, not fully used. Days 31\u201360: load vendors, run contracts through LLM, create terms table.' },
    { title: 'Keeper Password Manager', desc: 'Team using a spreadsheet. Days 31\u201360: implement properly, replace spreadsheet.' },
    { title: 'Phantom Equity Details', desc: 'Need plan docs, vesting terms, 409A treatment.' },
    { title: '2026 Growth Strategy', desc: '50% organic / 50% team acquisitions. Comp model competing with wirehouses.' },
    { title: 'Aquilance Financials', desc: '$12M actual / $14M run rate. Operating losses historically wiped out Pennington gains.' },
    { title: '$86M Opportunity Zone Fund', desc: 'Significant fund \u2014 track this.' },
    { title: 'Will & Trey Succession Track', desc: 'Being positioned to \u201Cscale beyond Brian.\u201D' },
    { title: 'Feb 20 SPV for Houston', desc: 'Fund admin item, stay on radar.' },
];

function renderContext() {
    const ctxState = JSON.parse(localStorage.getItem('penn-ctx-actions') || '{}');
    document.getElementById('ctx-updated').textContent = 'Last synced: Feb 11, 2026';

    let html = '';

    // Live Threads
    html += '<div class="section"><div class="section-title">Live Threads</div>';
    liveThreads.forEach(t => {
        html += '<div class="thread">';
        html += '<div class="thread-header">';
        html += `<span class="thread-title">${esc(t.title)}</span>`;
        html += `<span class="badge badge-${t.urgency}">${t.urgency}</span>`;
        t.tags.forEach(tag => { html += `<span class="badge badge-urgent">${esc(tag)}</span>`; });
        html += '</div>';
        html += `<div class="thread-summary">${esc(t.summary)}</div>`;
        html += `<div class="thread-action">\u2192 ${esc(t.action)}</div>`;
        html += '</div>';
    });
    html += '</div>';

    // Action Items
    html += '<div class="section"><div class="section-title">Immediate Actions</div>';
    ctxActionItems.forEach(item => {
        const done = ctxState[item.id] || false;
        html += `<div class="ctx-action ${done ? 'done' : ''}" data-ctx="${item.id}">`;
        html += `<div class="ctx-check"></div>`;
        html += `<div class="ctx-label">${esc(item.text)}</div></div>`;
    });
    html += '</div>';

    // Watching
    html += '<div class="section"><div class="section-title">Watching</div>';
    watchingItems.forEach(w => {
        html += `<div class="watch-item"><div class="watch-title">${esc(w.title)}</div>`;
        html += `<div class="watch-desc">${esc(w.desc)}</div></div>`;
    });
    html += '</div>';

    document.getElementById('ctx-sections').innerHTML = html;

    // Click handlers
    document.querySelectorAll('.ctx-action').forEach(el => {
        el.addEventListener('click', () => {
            const id = el.dataset.ctx;
            const state = JSON.parse(localStorage.getItem('penn-ctx-actions') || '{}');
            state[id] = !state[id];
            localStorage.setItem('penn-ctx-actions', JSON.stringify(state));
            el.classList.toggle('done');
        });
    });
}

// ═══════════════════════════════════════
// FLASHCARD DATA (Trimmed to highest leverage)
// ═══════════════════════════════════════
const flashcards = [
    // === COMPANY (3) ===
    { id: 1, cat: "Company", front: "What is Pennington's AUM?", back: "~$4 billion ($3.95B as of Dec 2024)\n250 clients, 12 core families" },
    { id: 2, cat: "Company", front: "What is Pennington's valuation and EBITDA?", back: "$60M valuation\n$3\u20134M EBITDA\n3 revenue streams: advisory fees, fund mgmt/performance fees, Aquilance" },
    { id: 3, cat: "Company", front: "What systems does Pennington use?", back: "**QuickBooks** \u2014 Accounting (Online for PPC/TX/AQ, Desktop for PAIM/Penn GM/SaaS/NSL)\n**Addepar** \u2014 Client portfolio reporting\n**Orion** \u2014 Fee calculation and billing\n**Sage Intacct** \u2014 Planned migration (has intercompany capability)" },

    // === ENTITIES (13) ===
    { id: 70, cat: "Entities", front: "What are the 4 advisory entities under Pennington's SEC registration?", back: "1. **Pennington Partners & Co., LLC** \u2014 Primary filing adviser (main RIA)\n2. **Pennington Alt Income Management, LLC** \u2014 Relying adviser\n3. **SaaS Ventures, LLC** \u2014 Related adviser (VC)\n4. **Pennington Private Access, LLC** \u2014 Related adviser" },
    { id: 71, cat: "Entities", front: "Who owns Pennington Partners & Co., LLC?", back: "**Brian Gaister** \u2014 50\u201375%\n**Rodd Macklin** \u2014 10\u201325%\n**Guy Scott** \u2014 <5%\n**GF Angel, LLC** \u2014 <5% (Brian's personal vehicle)" },
    { id: 72, cat: "Entities", front: "What is a 'relying adviser'?", back: "**Pennington Alt Income Management, LLC** has this status.\n\nOperates under the umbrella SEC registration of the primary filing adviser (PP&Co) rather than registering separately." },
    { id: 73, cat: "Entities", front: "What are the 3 Alternative Income funds?", back: "1. **Alt Income IDF** \u2014 $87.4M, 1 investor (insurance dedicated)\n2. **Alt Income Fund** \u2014 $24.8M, 24 investors (hedge fund)\n3. **Alt Income Access** \u2014 $13.9M, 25 investors (liquidity/feeder)\n\nAll managed by Pennington Alt Income Management, LLC" },
    { id: 74, cat: "Entities", front: "What are the 2 Real Estate / OZ funds?", back: "1. **PTM Partners OZF I** \u2014 $80.2M, 88 investors (Juniper Square admin)\n2. **PREP OZF** \u2014 $67.2M, 5 investors (NAV Consulting admin)\n   Launched Jan 2024, co-led by Taylor Coe & Alex Rongione" },
    { id: 75, cat: "Entities", front: "What is the GP/LP structure?", back: "Each fund (LP) has a dedicated **General Partner entity (GP LLC)**.\n\n\u2022 GP manages fund and makes investment decisions\n\u2022 GP earns management fees and carried interest\n\u2022 Separate GP entities provide liability isolation\n\u2022 LPs (investors) have limited liability" },
    { id: 76, cat: "Entities", front: "What is GF Angel, LLC?", back: "Brian Gaister's **personal investment vehicle / family office entity**.\n\n\u2022 Owns <5% of PP&Co directly\n\u2022 Listed in ADV but non-control person\n\u2022 Watch for: intercompany transactions, conflicts of interest" },
    { id: 77, cat: "Entities", front: "What is PTM Partners Fund Manager, LLC?", back: "A separate **management company** for PTM Partners funds.\n\n\u2022 Handles management fee collection and distribution\n\u2022 Distinct from specific GP entities\n\u2022 Key question: How do economics flow between Fund Manager and the GPs?" },
    { id: 78, cat: "Entities", front: "What are Fordham Street and Pennington-TX?", back: "**Fordham Street, LLC** \u2014 JV partner / SPV for PREP real estate assets\n\n**Pennington-TX, LLC** \u2014 Texas operations holding entity (Houston office, 1885 St. James Place)" },
    { id: 79, cat: "Entities", front: "How many total entities and why does it matter?", back: "**~49 legal entities** across:\n\u2022 4 advisory entities, 11 GP entities, 9+ funds, 5 holding/other\n\n**VP Finance implications:**\n\u2022 20+ sets of books, K-1s, tax returns, bank accounts\n\u2022 4 fund admins (JTC, Aduro, Juniper Square, NAV)\n\u2022 6+ custodians (Schwab, JPM, BNY Pershing, Avidbank, etc.)" },
    { id: 80, cat: "Entities", front: "Which fund admin handles which funds?", back: "**JTC Group:** Alt Income Fund, Alt Income IDF, Appreciation, Liquidity\n**Aduro Advisors:** Alt Income Access, Private Access\n**Juniper Square:** PTM OZF I, PTM OZF III\n**NAV Consulting:** PREP OZF\n**Allocations:** Atomizer LXIV" },
    { id: 81, cat: "Entities", front: "What is Aquilance?", back: "Pennington's **technology/SaaS subsidiary**.\n\u2022 Revenue: $12M actual / $14M run rate\n\u2022 Operating losses historically wiped out Pennington gains\n\u2022 Separate books (QuickBooks Online)\n\u2022 Key question: profitable yet? Path to profitability?" },
    { id: 82, cat: "Entities", front: "What are the SaaS Ventures and Appreciation funds?", back: "**Appreciation Fund** \u2014 $35.3M, 27 investors (JTC admin, Schwab custody)\n**SaaS Ventures Fund I** \u2014 GP: SaaS Ventures GP, LLC\n**SaaS Ventures Fund II** \u2014 GP: SaaS Ventures Fund II GP, LLC\nBoth co-founded by Brian & Rodd, focused on SaaS VC" },

    // === FUNDS (11) ===
    { id: 4, cat: "Funds", front: "List all 10 Pennington-managed funds.", back: "1. Alt Income IDF ($87.4M)\n2. PTM OZF I ($80.2M)\n3. PREP OZF ($67.2M)\n4. Appreciation Fund ($35.3M)\n5. Alt Income Fund ($24.8M)\n6. Alt Income Access ($13.9M)\n7. PTM OZF III ($8.1M)\n8. Private Access ($7.4M)\n9. Atomizer LXIV ($4.4M)\n10. Liquidity Fund ($1.0M)" },
    { id: 5, cat: "Funds", front: "Alt Income IDF, LP \u2014 Key Facts?", back: "AUM: **$87.4M** | Investors: **1** (insurance dedicated)\nAdmin: **JTC Group** | Custodian: **Schwab**\nLargest single-investor fund" },
    { id: 6, cat: "Funds", front: "PTM Partners OZF I, LP \u2014 Key Facts?", back: "AUM: **$80.2M** | Investors: **88**\nAdmin: **Juniper Square** | Custodian: **Schwab / National City Bank**\nOpportunity Zone fund" },
    { id: 7, cat: "Funds", front: "PREP OZF, LP \u2014 Key Facts?", back: "AUM: **$67.2M** | Investors: **5**\nAdmin: **NAV Consulting** | Custodian: **First Republic/JPM**\nLaunched Jan 2024, co-led by Taylor Coe & Alex Rongione" },
    { id: 8, cat: "Funds", front: "Appreciation Fund, LP \u2014 Key Facts?", back: "AUM: **$35.3M** | Investors: **27**\nAdmin: **JTC Group** | Custodian: **Schwab**\nVenture capital fund" },
    { id: 9, cat: "Funds", front: "Alt Income Fund, LP \u2014 Key Facts?", back: "AUM: **$24.8M** | Investors: **24**\nAdmin: **JTC Group** | Custodians: **BNY Pershing, JPMorgan Chase**\nHedge fund strategy" },
    { id: 10, cat: "Funds", front: "Alt Income Access, LP \u2014 Key Facts?", back: "AUM: **$13.9M** | Investors: **25**\nAdmin: **Aduro Advisors** | Custodians: **Avidbank, JPMorgan Chase**\nLiquidity/feeder fund" },
    { id: 11, cat: "Funds", front: "PTM Partners OZF III, LP \u2014 Key Facts?", back: "AUM: **$8.1M** | Investors: **35**\nAdmin: **Juniper Square** | Custodian: **Schwab / National City**\nOZ Fund III" },
    { id: 12, cat: "Funds", front: "Private Access, LP \u2014 Key Facts?", back: "AUM: **$7.4M** | Investors: **17**\nAdmin: **Aduro Advisors** | Custodians: **Avidbank, JPMorgan Chase**" },
    { id: 13, cat: "Funds", front: "Atomizer LXIV \u2014 Key Facts?", back: "AUM: **$4.4M** | Investors: **33**\nAdmin: **Allocations** | Custodian: **Evolve Bank & Trust**\nA series of Atomizer LLC" },
    { id: 14, cat: "Funds", front: "Liquidity Fund, LP \u2014 Key Facts?", back: "AUM: **$1.0M** | Investors: **11**\nAdmin: **JTC Group** | Custodian: **Schwab**\nSmallest fund" },

    // === OPERATIONS (10 new) ===
    { id: 200, cat: "Operations", front: "What are the key banking relationships?", back: "**JPMorgan Chase** \u2014 Primary (was First Republic Bank, acquired 2023)\n**Banc of California** \u2014 Secondary (was PacWest)\n**Avidbank** \u2014 Line of credit for operations\n\nFRB \u2192 JPM transition still in progress for some accounts." },
    { id: 201, cat: "Operations", front: "What is the Avidbank line of credit?", back: "Operating **line of credit** for Pennington Partners.\n\u2022 Used for: bridge funding, capital calls, operational float\n\u2022 Wire instructions must be pre-cleared\n\u2022 QuickBooks reporting needed for covenant compliance\n\u2022 Balance sheet cleanup required for reporting" },
    { id: 202, cat: "Operations", front: "What are the 3 revenue streams?", back: "1. **Advisory fees** \u2014 AUM-based, quarterly billing in arrears\n2. **Fund management + performance fees** \u2014 Carried interest from GPs\n3. **Aquilance** \u2014 SaaS/tech platform ($12M actual / $14M run rate)\n\nAdvisory = core, Funds = growth engine, Aquilance = wildcard" },
    { id: 203, cat: "Operations", front: "Key custodians and which funds?", back: "**Schwab** (primary): Alt Income IDF, Appreciation, Liquidity, OZF I, OZF III\n**BNY Pershing:** Alt Income Fund\n**JPMorgan Chase:** Alt Income Fund, Access, Private Access\n**Avidbank:** Alt Income Access, Private Access\n**First Republic/JPM:** PREP OZF\n**Evolve Bank:** Atomizer LXIV" },
    { id: 204, cat: "Operations", front: "How does advisory billing work?", back: "**Quarterly in arrears:**\n\u2022 Schwab: Bill through custodian platform\n\u2022 Fidelity: Bill through custodian platform\n\u2022 BNY Pershing: Manual billing process\n\n**Orion** used for fee calculations\nFee schedules vary by client type (OPF, Advisory, Platform)" },
    { id: 205, cat: "Operations", front: "What is the capital call process?", back: "1. Fund manager determines capital need\n2. Finance calculates each LP's pro-rata share\n3. Capital call notice sent (usually 10 biz days)\n4. Wire instructions included\n5. Funds received and reconciled\n\n**ZERO ERROR PROCESS** \u2014 John's predecessor got wrong amount/account" },
    { id: 206, cat: "Operations", front: "Revenue share process \u2014 why is it critical?", back: "Advisory fees \u2192 rev share calculated for advisors\n**Current flow:** Orion billing \u2192 rev share calc (failed in Orion) \u2192 Excel\n\nLast cycle was **very delayed \u2014 Brian was furious**.\nBrian wants a \u201Cworld-class\u201D rev share file.\n**HIGH VISIBILITY** project." },
    { id: 207, cat: "Operations", front: "What are the key compliance deadlines?", back: "**Form ADV:** Annual amendment due Mar 31 (90 days after FY end)\n**Audited financials:** Required for pooled investment vehicles\n**1099s:** Due to recipients Jan 31, filed by Mar 31\n**K-1s:** Due per Schedule K-1 deadline\n**State filings:** Various notice filings\n**SEC exam:** Can happen anytime (surprise)" },
    { id: 208, cat: "Operations", front: "ADP Payroll \u2014 which entities?", back: "3 entities on ADP payroll:\n1. **Pennington Partners & Co.** (main RIA)\n2. **Pennington-TX** (Houston operations)\n3. **Aquilance** (tech platform)\n\nPayroll runs **every other Friday**.\nKaufman salary increase needs to be processed correctly." },
    { id: 209, cat: "Operations", front: "What\u2019s broken about QuickBooks reporting?", back: "**Balance sheet is a mess** \u2014 needs cleanup\n\u2022 QB Online: PPC, TX, AQ\n\u2022 QB Desktop: PAIM, Penn GM, SaaS, NSL, others\n\nGoal: auto-extract BS, IS, cash flow for consolidated view.\nNeeded for Avidbank line of credit covenants.\nFuture: Sage Intacct has enterprise intercompany capability." },

    // === TAX STRATEGIES (18) ===
    { id: 90, cat: "Tax", front: "List the 8 Capital Gains Mitigation Strategies.", back: "1. Long Only Equity SMA\n2. Levered Equity SMA\n3. 351 Exchange\n4. QSBS (Qualified Small Business Stock)\n5. 1031 Exchange\n6. Opportunity Zones\n7. DAF (Donor Advised Fund)\n8. CRUT (Charitable Remainder Unitrust)" },
    { id: 91, cat: "Tax", front: "List the 8 Ordinary Income Mitigation Strategies.", back: "1. Clean Energy Credits\n2. Tax-Efficient Hedge Funds\n3. Accelerated Depreciation (Equipment Rental)\n4. Working Oil Interests (IDCs)\n5. Management Company\n6. PPLI (Private Placement Life Insurance)\n7. REP / Material Participation\n8. Non-Grantor Trusts for Businesses" },
    { id: 92, cat: "Tax", front: "Long Only Equity SMA", back: "Direct-indexing portfolio \u2014 sells individual losing stocks to offset gains (**tax-loss harvesting**).\n\nThe \u201Cvanilla\u201D option. Loss-generation ability decays as market rises." },
    { id: 93, cat: "Tax", front: "Levered Equity SMA", back: "Long/short portfolio (e.g., 145/45) that magnifies volatility to harvest **massive short-term capital losses**.\n\nThe \u201Cheavy artillery.\u201D Can generate losses even in up-markets. Higher fees." },
    { id: 94, cat: "Tax", front: "351 Exchange", back: "Contributing concentrated public stock into a diversified partnership **without triggering a sale**.\n\nThe \u201Cdiversifier.\u201D Only way to diversify a concentrated position immediately with zero tax." },
    { id: 95, cat: "Tax", front: "QSBS (Qualified Small Business Stock)", back: "Federal exemption for stock held **5+ years** in C-Corp with **<$50M assets**.\n\nThe \u201Ceraser.\u201D Eliminates tax entirely (up to $10M or 10x basis). Doesn't just defer \u2014 erases." },
    { id: 96, cat: "Tax", front: "1031 Exchange", back: "Swapping one investment property for another to **defer capital gains**.\n\nThe \u201Creal estate swap.\u201D Strictly RE-to-RE only. Can\u2019t move to other asset classes like OZ funds." },
    { id: 97, cat: "Tax", front: "Opportunity Zones (OZ)", back: "Investing capital gains into distressed areas \u2014 **defer tax until 2026**, eliminate tax on new growth.\n\nThe \u201C10-year play.\u201D Requires 10-year hold for tax-free appreciation. Less liquid than 1031." },
    { id: 98, cat: "Tax", front: "DAF (Donor Advised Fund)", back: "Donating assets to a charitable account for an **immediate tax deduction**.\n\nThe \u201Cwrite-off.\u201D Full deduction up front, but the money is legally **gone forever** (unlike CRUT)." },
    { id: 99, cat: "Tax", front: "CRUT (Charitable Remainder Unitrust)", back: "Trust that pays you **income for life**, remainder goes to charity.\n\nThe \u201Cincome stream.\u201D You retain 7\u201310% annual distributions (unlike DAF). Smaller upfront deduction." },
    { id: 150, cat: "Tax", front: "Clean Energy Credits (ITC)", back: "Buying transferable tax credits from renewable energy developers.\n\nThe \u201Csimple offset.\u201D Turnkey ~1.2x after-tax payback. Requires material participation for active income offset." },
    { id: 151, cat: "Tax", front: "Tax-Efficient Hedge Funds", back: "Hedge funds structured to pass through **ordinary losses** to investors while generating returns.\n\nThe \u201Cdouble dip.\u201D Pre-tax returns + loss offsets. No control over timing." },
    { id: 152, cat: "Tax", front: "Accelerated Depreciation (Equipment Rental)", back: "Buy heavy equipment to lease out, use bonus depreciation for **massive Year 1 paper loss** (~75% of equity).\n\nThe \u201Cphantom loss.\u201D Depreciation recaptured (taxed) on sale." },
    { id: 153, cat: "Tax", front: "Working Oil Interests (IDCs)", back: "Direct oil/gas drilling investment \u2014 drilling costs (IDCs) are **100% deductible upfront**.\n\nThe \u201Cactive loophole.\u201D Uniquely offsets active income without strict Material Participation tests." },
    { id: 154, cat: "Tax", front: "Management Company", back: "Forming an entity to manage the family\u2019s wealth.\n\nThe \u201Cexpense deduction.\u201D Converts non-deductible investment advice fees into **deductible business expenses**." },
    { id: 155, cat: "Tax", front: "PPLI (Private Placement Life Insurance)", back: "Wrapping investments inside an insurance policy to **grow tax-free**.\n\nThe \u201Cwrapper.\u201D Eliminates tax drag, but high setup costs = only for >$5M long-term allocations." },
    { id: 156, cat: "Tax", front: "REP / Material Participation", back: "Tax status allowing real estate **paper losses (depreciation) to offset W-2/active income**.\n\nThe \u201Choly grail.\u201D Most powerful offset available. Requires **750-hour work test**." },
    { id: 157, cat: "Tax", front: "Non-Grantor Trusts for Businesses", back: "Moving business interest into a trust to treat income as **\u201Cpassive.\u201D**\n\nThe \u201Cmatchmaker.\u201D Turns active income passive so it can be erased by stranded passive losses." },

    // === APPLIED FRAMEWORKS (8) ===
    { id: 19, cat: "Frameworks", front: "How to apply Carnegie with Brian?", back: "\u2022 Frame requests in terms of what **HE** wants (decisions, not data)\n\u2022 Let him feel ownership of ideas\n\u2022 Admit mistakes quickly and emphatically\n\u2022 Give sincere appreciation for his guidance\n\u2022 Don\u2019t argue \u2014 ask questions instead" },
    { id: 24, cat: "Frameworks", front: "How to apply Slootman at Pennington?", back: "\u2022 Match or exceed Brian\u2019s operating tempo\n\u2022 Pick 2\u20133 priorities \u2014 not 10\n\u2022 Own problems end-to-end without being asked\n\u2022 Don\u2019t over-study \u2014 execute\n\u2022 Raise the bar on finance team output" },
    { id: 28, cat: "Frameworks", front: "How to apply Gawande at Pennington?", back: "\u2022 Build checklists: close, billing, capital calls, reporting, onboarding\n\u2022 John\u2019s capital call error = checklist would have caught it\n\u2022 Checklists = trust with Brian (he doesn\u2019t have to check your work)\n\u2022 After every error, update the checklist" },
    { id: 36, cat: "Frameworks", front: "How to apply Pfeffer at Pennington?", back: "\u2022 **Control resources:** Own financial data and analysis\n\u2022 **Get visible:** Position in strategy discussions\n\u2022 **Build network:** Beyond finance (Taylor/Alex, Guy, clients)\n\u2022 **Ask directly:** Be explicit about CFO path\n\u2022 **Early wins:** Fix something visible in first 30 days\n\u2022 **Create scarcity:** Only one who sees full financial picture" },
    { id: 50, cat: "Frameworks", front: "How to apply Willink at Pennington?", back: "\u2022 **Extreme Ownership:** Own every outcome \u2014 no excuses\n\u2022 **No blame:** Fix it, don\u2019t point fingers\n\u2022 **Simple:** Explain financials so anyone understands\n\u2022 **Prioritize & Execute:** One thing, finish, next\n\u2022 **Lead up:** If Brian doesn\u2019t have what he needs, that\u2019s on you\n\u2022 **Decentralize:** Train team to operate without you" },
    { id: 66, cat: "Frameworks", front: "How to apply Sterner at Pennington?", back: "\u2022 **Process over product:** Don\u2019t fixate on CFO title \u2014 focus on today\n\u2022 **DOC method:** Do, observe, correct \u2014 no self-judgment\n\u2022 **Four S\u2019s:** Simplify, Small, Short, Slow (for overwhelm)\n\u2022 **Single-task:** One thing at a time, fully present\n\u2022 **Non-judgment:** Mistakes aren\u2019t failures, they\u2019re data" },
    { id: 29, cat: "Frameworks", front: "How do all 6 books work together?", back: "**Making a mistake:** Carnegie: admit fast. Slootman: fix fast. Gawande: update checklist. Willink: own it. Sterner: observe, correct, move on.\n\n**Overwhelmed:** Slootman: pick 2\u20133. Gawande: checklist. Willink: prioritize & execute. Sterner: Four S\u2019s.\n\n**Managing up:** Carnegie: his interests. Slootman: match tempo. Pfeffer: be indispensable. Willink: communicate." },
    { id: 31, cat: "Frameworks", front: "What killed John? (All 6 books)", back: "Carnegie: Didn\u2019t own mistakes. Slootman: Passenger, low tempo. Gawande: No checklist for capital call. Pfeffer: No power base, replaceable. Willink: Blamed circumstances, didn\u2019t lead up. Sterner: Focused on looking competent, not doing the work.\n\n**The fix:** Own everything, blame nothing, simplify, train your replacement." },
];

// ═══════════════════════════════════════
// FLASHCARD ENGINE
// ═══════════════════════════════════════
let fcProgress = {};
let fcMode = 'due';
let fcCat = 'all';
let fcDeck = [];
let fcIdx = 0;
let fcFlipped = false;
let fcSession = { correct: 0, incorrect: 0 };
let syncCode = localStorage.getItem('pennington-sync-code') || '';

const fcCategories = ['all', ...new Set(flashcards.map(c => c.cat))];

function initFC() {
    flashcards.forEach(c => {
        if (!fcProgress[c.id]) fcProgress[c.id] = { level: 0, nextReview: Date.now(), lastReview: null };
    });
}

function buildFCFilters() {
    document.getElementById('fc-filters').innerHTML = fcCategories.map(c =>
        `<button class="fc-filter-btn ${fcCat === c ? 'active' : ''}" data-cat="${c}">${c === 'all' ? 'All' : c}</button>`
    ).join('');
    document.getElementById('fc-filters').querySelectorAll('.fc-filter-btn').forEach(btn => {
        btn.addEventListener('click', () => { fcCat = btn.dataset.cat; buildFCFilters(); buildFCDeck(); renderFC(); });
    });

    document.getElementById('fc-modes').innerHTML = ['due','all','shuffle'].map(m =>
        `<button class="fc-mode-btn ${fcMode === m ? 'active' : ''}" data-mode="${m}">${m === 'due' ? 'Due' : m === 'all' ? 'All' : 'Shuffle'}</button>`
    ).join('');
    document.getElementById('fc-modes').querySelectorAll('.fc-mode-btn').forEach(btn => {
        btn.addEventListener('click', () => { fcMode = btn.dataset.mode; buildFCFilters(); buildFCDeck(); renderFC(); });
    });
}

function buildFCDeck() {
    let cards = flashcards;
    if (fcCat !== 'all') cards = cards.filter(c => c.cat === fcCat);
    if (fcMode === 'due') {
        const now = Date.now();
        cards = cards.filter(c => { const p = fcProgress[c.id]; return p && (p.nextReview <= now || p.level === 0); });
        cards.sort((a, b) => (fcProgress[a.id]?.level || 0) - (fcProgress[b.id]?.level || 0));
    } else if (fcMode === 'shuffle') {
        cards = [...cards].sort(() => Math.random() - 0.5);
    }
    fcDeck = cards; fcIdx = 0; fcFlipped = false; fcSession = { correct: 0, incorrect: 0 };
}

function getNextReview(level) {
    const intervals = [0, 60000, 600000, 3600000, 86400000, 604800000];
    return Date.now() + (intervals[level] || intervals[5]);
}

function updateFCStats() {
    const mastered = flashcards.filter(c => fcProgress[c.id]?.level >= 5).length;
    const learning = flashcards.filter(c => { const l = fcProgress[c.id]?.level || 0; return l > 0 && l < 5; }).length;
    document.getElementById('fc-mastered').textContent = `Mastered: ${mastered}`;
    document.getElementById('fc-learning').textContent = `Learning: ${learning}`;
    document.getElementById('fc-total').textContent = `Total: ${flashcards.length}`;
    document.getElementById('fc-progress').style.width = `${(mastered / flashcards.length) * 100}%`;
}

function renderFC() {
    updateFCStats();
    const area = document.getElementById('fc-area');
    if (fcDeck.length === 0 || fcIdx >= fcDeck.length) {
        if (fcMode === 'due' && fcDeck.length === 0) {
            area.innerHTML = '<div class="fc-empty"><h3>All caught up!</h3><p>No cards due for review.</p></div>';
        } else {
            area.innerHTML = `<div class="fc-empty"><h3>Session Complete!</h3><p>Correct: ${fcSession.correct} | Review: ${fcSession.incorrect}</p><button class="fc-btn fc-btn-restart" onclick="window._fcRestart()">New Session</button></div>`;
        }
        return;
    }
    const card = fcDeck[fcIdx];
    area.innerHTML = `
        <div class="fc-card-wrap">
            <div class="fc-card ${fcFlipped ? 'flipped' : ''}" onclick="window._fcFlip()">
                <div class="fc-face fc-front">
                    <div class="fc-cat">${card.cat}</div>
                    <div class="fc-label">Question ${fcIdx + 1} of ${fcDeck.length}</div>
                    <div class="fc-text">${fmt(card.front)}</div>
                    <div class="fc-hint">Tap to reveal</div>
                </div>
                <div class="fc-face fc-back">
                    <div class="fc-cat">${card.cat}</div>
                    <div class="fc-label">Answer</div>
                    <div class="fc-text">${fmt(card.back)}</div>
                </div>
            </div>
        </div>
        <div class="fc-controls">
            ${fcFlipped ? `<button class="fc-btn fc-btn-again" onclick="window._fcMark(false)">Again</button><button class="fc-btn fc-btn-good" onclick="window._fcMark(true)">Got it</button>` : `<button class="fc-btn fc-btn-flip" onclick="window._fcFlip()">Show Answer</button>`}
        </div>`;
}

window._fcFlip = () => { fcFlipped = !fcFlipped; renderFC(); };
window._fcMark = (correct) => {
    const card = fcDeck[fcIdx];
    const p = fcProgress[card.id];
    if (correct) { p.level = Math.min(5, p.level + 1); fcSession.correct++; }
    else { p.level = Math.max(0, p.level - 1); fcSession.incorrect++; }
    p.nextReview = getNextReview(p.level); p.lastReview = Date.now();
    saveFC(); fcIdx++; fcFlipped = false; renderFC();
};
window._fcRestart = () => { buildFCDeck(); renderFC(); };

// Firebase sync for flashcards
async function saveFC() {
    localStorage.setItem('pennington-flashcards-v3', JSON.stringify(fcProgress));
    if (!db || !syncCode) return;
    try {
        const docRef = doc(db, 'flashcard-progress', syncCode);
        await setDoc(docRef, { progress: fcProgress, lastUpdated: new Date().toISOString() });
        document.getElementById('sync-status').className = 'sync-status synced';
        document.getElementById('sync-status').textContent = 'Synced';
    } catch(e) {
        document.getElementById('sync-status').className = 'sync-status offline';
        document.getElementById('sync-status').textContent = 'Save failed';
    }
}

function connectFirebase() {
    if (!db) {
        document.getElementById('sync-status').className = 'sync-status offline';
        document.getElementById('sync-status').textContent = 'Offline mode';
        loadFCLocal(); return;
    }
    if (!syncCode) { document.getElementById('sync-modal').style.display = 'flex'; return; }
    if (unsubscribe) unsubscribe();
    document.getElementById('sync-status').textContent = 'Connecting...';
    try {
        const docRef = doc(db, 'flashcard-progress', syncCode);
        unsubscribe = onSnapshot(docRef, (snap) => {
            if (snap.exists()) fcProgress = snap.data().progress || {};
            else fcProgress = {};
            document.getElementById('sync-status').className = 'sync-status synced';
            document.getElementById('sync-status').textContent = 'Synced';
            initFC();
            localStorage.setItem('pennington-flashcards-v3', JSON.stringify(fcProgress));
            buildFCDeck(); renderFC();
        }, () => { loadFCLocal(); });
    } catch(e) { loadFCLocal(); }
}

function loadFCLocal() {
    fcProgress = JSON.parse(localStorage.getItem('pennington-flashcards-v3') || '{}');
    initFC(); buildFCDeck(); renderFC();
    document.getElementById('sync-status').className = 'sync-status offline';
    document.getElementById('sync-status').textContent = 'Offline';
}

// Sync modal
document.getElementById('sync-code-show').textContent = syncCode || 'Not set';
document.getElementById('btn-change-sync').addEventListener('click', () => {
    document.getElementById('sync-input').value = syncCode;
    document.getElementById('sync-modal').style.display = 'flex';
    document.getElementById('sync-input').focus();
});
document.getElementById('btn-set-sync').addEventListener('click', () => {
    const code = document.getElementById('sync-input').value.trim().toLowerCase().replace(/\s+/g, '-');
    if (!code) return;
    syncCode = code;
    localStorage.setItem('pennington-sync-code', syncCode);
    document.getElementById('sync-code-show').textContent = syncCode;
    document.getElementById('sync-modal').style.display = 'none';
    connectFirebase();
});
document.getElementById('btn-cancel-sync').addEventListener('click', () => {
    document.getElementById('sync-modal').style.display = 'none';
    if (!syncCode) loadFCLocal();
});
document.getElementById('sync-input').addEventListener('keypress', (e) => {
    if (e.key === 'Enter') document.getElementById('btn-set-sync').click();
});

// ═══════════════════════════════════════
// PEOPLE ENGINE
// ═══════════════════════════════════════
const people = [
    { id: 1, name: "Brian Gaister", title: "Co-Founder, CEO", cat: "Leadership", photo: "https://images.squarespace-cdn.com/content/v1/611bf6efa3a9575b9bdd22c1/80bf71a3-7677-4e91-9b95-2e374208e944/f_220042_110016_8x10.jpg" },
    { id: 2, name: "Rodd Macklin", title: "Co-Founder, Senior Managing Director", cat: "Leadership", photo: "https://images.squarespace-cdn.com/content/v1/611bf6efa3a9575b9bdd22c1/1633905262294-O1KLD0YCSKDLFWNF9YJ9/Rodd%2BMacklin.jpg" },
    { id: 3, name: "Kent Andrews", title: "Partner, Investments", cat: "Leadership", photo: "https://images.squarespace-cdn.com/content/v1/611bf6efa3a9575b9bdd22c1/1638898224652-QHE08BDVK9JS4ACLG7T0/Kent%2BAndrews_8x10.jpg" },
    { id: 4, name: "Jill Sheppard Davenport", title: "Partner, Health & Wellness", cat: "Leadership", photo: "https://images.squarespace-cdn.com/content/v1/611bf6efa3a9575b9bdd22c1/1e0953ea-ad53-43c4-bb4a-535f500e03ec/DSC_7717rev1.jpg" },
    { id: 5, name: "Michael Rubenstein", title: "Partner, Tax Minimization", cat: "Leadership", photo: "https://images.squarespace-cdn.com/content/v1/611bf6efa3a9575b9bdd22c1/356377f1-e97e-415a-8083-6aa713015138/Rubenstein_0946_4x6print_bw.jpg" },
    { id: 6, name: "Keith Kellum", title: "Partner & Portfolio Manager", cat: "Leadership", photo: "https://images.squarespace-cdn.com/content/v1/611bf6efa3a9575b9bdd22c1/6f7020f3-2239-48e8-b59d-b6dc67bbd552/k.png" },
    { id: 7, name: "Marilyn Santiago", title: "Partner, Relationship Mgmt", cat: "Leadership", photo: "https://images.squarespace-cdn.com/content/v1/611bf6efa3a9575b9bdd22c1/41c930fe-f726-43de-a6d3-2588303a6033/M.png" },
    { id: 8, name: "Wendy Xu", title: "MD, Private Markets", cat: "Investments", photo: "https://images.squarespace-cdn.com/content/v1/611bf6efa3a9575b9bdd22c1/fcea32f1-e26a-4e68-8e1e-417906604149/Wendy+Xu+-+Headshot.jpg" },
    { id: 9, name: "Taylor Coe", title: "MD, Real Estate Partners", cat: "Real Estate", photo: "https://images.squarespace-cdn.com/content/v1/611bf6efa3a9575b9bdd22c1/da1de05b-5b0a-4dbc-9d9b-97e8c3f058d0/Taylor.jpg" },
    { id: 10, name: "Alex Rongione", title: "MD, Real Estate Partners", cat: "Real Estate", photo: "https://images.squarespace-cdn.com/content/v1/611bf6efa3a9575b9bdd22c1/00b21095-1596-433f-a61f-5c7b837befcc/Alex.jpg" },
    { id: 11, name: "Trey Sheain", title: "Portfolio Manager, CFA", cat: "Investments", photo: "https://images.squarespace-cdn.com/content/v1/611bf6efa3a9575b9bdd22c1/54fc879a-6a96-4745-93c4-67862ecc1409/Sheain_1002_4x4print_Square_BW.jpg" },
    { id: 12, name: "Matthew Devine", title: "Portfolio Manager, CFA", cat: "Investments", photo: "https://images.squarespace-cdn.com/content/v1/611bf6efa3a9575b9bdd22c1/bd070fda-8e31-4d71-886f-3be6750d75dd/Matt+Devine+-+headshot.jpg" },
    { id: 13, name: "William Lowrie", title: "Portfolio Manager, CFA", cat: "Investments", photo: "https://images.squarespace-cdn.com/content/v1/611bf6efa3a9575b9bdd22c1/d2575a2a-a844-4821-8ec3-7e2b2146fd30/Will+Lowrie-modified.jpg" },
    { id: 14, name: "Megan Bleil", title: "Partner, Family Office Advisor", cat: "Client Services", photo: "https://images.squarespace-cdn.com/content/v1/611bf6efa3a9575b9bdd22c1/1634746751089-OFA1WQ0V8342Z05072ZN/Megan%2BBleil_new%2BBIG%2BFILE.jpg" },
    { id: 15, name: "Will Halkyard", title: "Client Relationship Officer", cat: "Client Services", photo: "https://images.squarespace-cdn.com/content/v1/611bf6efa3a9575b9bdd22c1/c7e6d5b7-07e7-41b3-96e1-6f34b4048f3d/Will+Helkart+Headshot.png" },
    { id: 16, name: "Olimpia Sulla", title: "Director, Wealth Strategy", cat: "Client Services", photo: "https://images.squarespace-cdn.com/content/v1/611bf6efa3a9575b9bdd22c1/d0e3f38e-ca96-4e1d-8aba-5b1d2e631404/f_240046_110051.jpg" },
    { id: 17, name: "Megan Graf", title: "Senior Operations Advisor", cat: "Operations", photo: "https://images.squarespace-cdn.com/content/v1/611bf6efa3a9575b9bdd22c1/425098c5-315c-4293-bc7e-665d91e039c4/Graf%2C+Megan3656-headshot-full_frame-hires_bw+%282%29+%281%29.jpg" },
    { id: 18, name: "Guy Scott", title: "Chief Compliance Officer", cat: "Operations", photo: "https://images.squarespace-cdn.com/content/v1/611bf6efa3a9575b9bdd22c1/eb81bebd-2f56-4ec2-8863-8036e125b21e/u_210122_110082+Pennington.jpg" },
    { id: 19, name: "David Bell", title: "Senior Legal Advisor", cat: "Operations", photo: "https://images.squarespace-cdn.com/content/v1/611bf6efa3a9575b9bdd22c1/77751dea-4029-4697-a8a4-60595c01cbfe/Screenshot+2025-06-18+152237.png" },
    { id: 20, name: "Chad Lilly", title: "VP, Head of Talent Acquisition", cat: "Operations", photo: "https://images.squarespace-cdn.com/content/v1/611bf6efa3a9575b9bdd22c1/00e05149-7353-493a-8dc7-a2c7d8507e35/Chad+Lilly+-+Headshot.jpg" },
    { id: 21, name: "John Rizas", title: "Director of Finance", cat: "Finance", photo: "https://images.squarespace-cdn.com/content/v1/611bf6efa3a9575b9bdd22c1/17eda384-47c9-447d-857c-5144100e6d60/Rizas_Headshot.jpg" },
    { id: 22, name: "Nadia Khan", title: "Senior Staff Accountant", cat: "Finance", photo: "https://images.squarespace-cdn.com/content/v1/611bf6efa3a9575b9bdd22c1/f801e0d7-12ee-47c0-8d93-732daede3e4f/Nadia+headshot.jpg" },
    { id: 23, name: "Jacob Reinhardt", title: "Investment Analyst", cat: "Investments", photo: "https://images.squarespace-cdn.com/content/v1/611bf6efa3a9575b9bdd22c1/24417788-c8df-434f-8701-0af8526d462e/Jacob+Reinhardt+Headshot.png" },
    { id: 24, name: "Longhe Cao", title: "Investment Analyst", cat: "Investments", photo: "https://images.squarespace-cdn.com/content/v1/611bf6efa3a9575b9bdd22c1/649d0be1-5e49-4c72-89ea-26067215964b/Longhe+Cao+Headshot.png" },
    { id: 25, name: "Nicole Clark-Ramirez", title: "Health & Wellness Specialist", cat: "Client Services", photo: "https://images.squarespace-cdn.com/content/v1/611bf6efa3a9575b9bdd22c1/683f4d8f-5eeb-4794-a779-bcafccc333b1/unnamed.png" },
    { id: 26, name: "Jamie McLaughlin", title: "Senior Advisor", cat: "Advisors", photo: "https://images.squarespace-cdn.com/content/v1/611bf6efa3a9575b9bdd22c1/6faa2093-a1df-481b-9eb6-1b043b36058c/Jamie+McLaughlin.jpg" },
    { id: 27, name: "Philip Strassler", title: "Senior Advisor, CPA", cat: "Advisors", photo: "https://images.squarespace-cdn.com/content/v1/611bf6efa3a9575b9bdd22c1/14fbbdfd-ffa5-40d7-a66e-c9862839ad3c/strassler.jpg" },
    { id: 28, name: "Roger Staiger", title: "Senior Real Estate Advisor", cat: "Advisors", photo: "https://images.squarespace-cdn.com/content/v1/611bf6efa3a9575b9bdd22c1/1636058549216-VID20KECP4LX4XJWSHZ3/RPS_Pic.jpg" },
    { id: 29, name: "Tommy Wright", title: "Senior Advisor", cat: "Advisors", photo: "https://images.squarespace-cdn.com/content/v1/611bf6efa3a9575b9bdd22c1/d4ac55c8-6103-486f-ba01-7cf4f65b2577/Screenshot+2025-06-03+102915.png" },
    { id: 30, name: "Sehkar Puli", title: "Senior Advisor", cat: "Advisors", photo: "https://images.squarespace-cdn.com/content/v1/611bf6efa3a9575b9bdd22c1/09fc5595-fd9e-422d-ad9d-d867e5bfe677/Sehkar+Headshot.png" },
    { id: 31, name: "Barak Kaufman", title: "Senior Advisor", cat: "Advisors", photo: "https://images.squarespace-cdn.com/content/v1/611bf6efa3a9575b9bdd22c1/9cfa91b6-a509-4399-be7d-6abef54c7906/Barak+Headshot.png" },
    { id: 32, name: "David Homan", title: "Senior Advisor", cat: "Advisors", photo: "https://images.squarespace-cdn.com/content/v1/611bf6efa3a9575b9bdd22c1/e251c428-516a-43e2-b724-f9b84a7536dd/Daivd+Homan+.png" },
    { id: 33, name: "Eric Rosen", title: "Senior Advisor", cat: "Advisors", photo: "https://images.squarespace-cdn.com/content/v1/611bf6efa3a9575b9bdd22c1/2aa6e7fd-144c-4214-a515-5aaada91233f/Eric+Rosen.jpg" },
    { id: 34, name: "Daniel Erem", title: "Senior Advisor", cat: "Advisors", photo: "https://images.squarespace-cdn.com/content/v1/611bf6efa3a9575b9bdd22c1/1dfc7bd5-736d-4ffd-b780-27603f90db45/Daniel+Erem.png" },
    { id: 35, name: "Tod Trabocco", title: "Senior Advisor", cat: "Advisors", photo: "https://images.squarespace-cdn.com/content/v1/611bf6efa3a9575b9bdd22c1/3823009c-4fcf-487d-b650-9bebf7fea6ce/Tod%252BTrabocco.jpeg" },
    { id: 36, name: "Lauren Lennahan", title: "Marketing Manager", cat: "Operations", photo: "https://images.squarespace-cdn.com/content/v1/611bf6efa3a9575b9bdd22c1/c5d81661-1e28-478f-a403-1e62d378698f/Lauren+Headshot.png" },
    { id: 37, name: "Jake Brophy", title: "Sr Associate, Operations", cat: "Operations", photo: "https://images.squarespace-cdn.com/content/v1/611bf6efa3a9575b9bdd22c1/79372e0b-0b51-4b14-9bd3-5a79daefea3a/Jake+Brophy.jpg" },
    { id: 38, name: "Odessa Clear", title: "Operations Associate", cat: "Operations", photo: "https://images.squarespace-cdn.com/content/v1/611bf6efa3a9575b9bdd22c1/4a08994c-f565-47c9-8511-6821fe168302/Odessa+Clear+Headshot.png" },
    { id: 39, name: "Hannah Aurich", title: "Client Relationship Officer", cat: "Client Services", photo: "https://images.squarespace-cdn.com/content/v1/611bf6efa3a9575b9bdd22c1/be9327ff-fe67-4cda-abc9-dfddcf48d9bb/Hannah+Aurich.jpg" },
    { id: 40, name: "Ben Pieroni", title: "Client Relationship Officer", cat: "Client Services", photo: "https://images.squarespace-cdn.com/content/v1/611bf6efa3a9575b9bdd22c1/3c2209f3-824b-4fb9-a81e-4ccbe1528808/Screenshot+2025-12-30+124810.png" },
    { id: 41, name: "Courtney Bates", title: "Executive Assistant", cat: "Operations", photo: "https://images.squarespace-cdn.com/content/v1/611bf6efa3a9575b9bdd22c1/943dbabd-dc6d-455d-8349-0fdc3db5c40e/Bates_2356_500x500px_72dpi_Square.jpg" }
];

let pplProgress = JSON.parse(localStorage.getItem('pennington-people') || '{}');
let pplMode = 'due';
let pplCat = 'all';
let pplDeck = [];
let pplIdx = 0;
let pplFlipped = false;
let pplSession = { correct: 0, incorrect: 0 };

const pplCategories = ['all', ...new Set(people.map(p => p.cat))];

function initPpl() {
    people.forEach(p => {
        if (!pplProgress[p.id]) pplProgress[p.id] = { level: 0, nextReview: Date.now(), lastReview: null };
    });
    localStorage.setItem('pennington-people', JSON.stringify(pplProgress));
}

function buildPplFilters() {
    document.getElementById('ppl-filters').innerHTML = pplCategories.map(c =>
        `<button class="fc-filter-btn ${pplCat === c ? 'active' : ''}" data-pcat="${c}">${c === 'all' ? 'All' : c}</button>`
    ).join('');
    document.getElementById('ppl-filters').querySelectorAll('.fc-filter-btn').forEach(btn => {
        btn.addEventListener('click', () => { pplCat = btn.dataset.pcat; buildPplFilters(); buildPplDeck(); renderPpl(); });
    });

    document.getElementById('ppl-modes').innerHTML = ['due','all','shuffle'].map(m =>
        `<button class="fc-mode-btn ${pplMode === m ? 'active' : ''}" data-pmode="${m}">${m === 'due' ? 'Due' : m === 'all' ? 'All' : 'Shuffle'}</button>`
    ).join('');
    document.getElementById('ppl-modes').querySelectorAll('.fc-mode-btn').forEach(btn => {
        btn.addEventListener('click', () => { pplMode = btn.dataset.pmode; buildPplFilters(); buildPplDeck(); renderPpl(); });
    });
}

function buildPplDeck() {
    let cards = people;
    if (pplCat !== 'all') cards = cards.filter(p => p.cat === pplCat);
    if (pplMode === 'due') {
        const now = Date.now();
        cards = cards.filter(p => pplProgress[p.id].nextReview <= now || pplProgress[p.id].level === 0);
        cards.sort((a, b) => pplProgress[a.id].level - pplProgress[b.id].level);
    } else if (pplMode === 'shuffle') {
        cards = [...cards].sort(() => Math.random() - 0.5);
    }
    pplDeck = cards; pplIdx = 0; pplFlipped = false; pplSession = { correct: 0, incorrect: 0 };
}

function updatePplStats() {
    const mastered = people.filter(p => pplProgress[p.id]?.level >= 5).length;
    const learning = people.filter(p => { const l = pplProgress[p.id]?.level || 0; return l > 0 && l < 5; }).length;
    document.getElementById('ppl-mastered').textContent = `Mastered: ${mastered}`;
    document.getElementById('ppl-learning').textContent = `Learning: ${learning}`;
    document.getElementById('ppl-total').textContent = `Total: ${people.length}`;
    document.getElementById('ppl-progress').style.width = `${(mastered / people.length) * 100}%`;
}

const noPhoto = "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='200' height='200'><rect fill='%23333' width='200' height='200'/><text fill='%23666' x='100' y='110' text-anchor='middle' font-size='14'>No Photo</text></svg>";

function renderPpl() {
    updatePplStats();
    const area = document.getElementById('ppl-area');
    if (pplDeck.length === 0 || pplIdx >= pplDeck.length) {
        if (pplMode === 'due' && pplDeck.length === 0) {
            area.innerHTML = '<div class="fc-empty"><h3>All caught up!</h3><p>No people due for review.</p></div>';
        } else {
            area.innerHTML = `<div class="fc-empty"><h3>Session Complete!</h3><p>Correct: ${pplSession.correct} | Review: ${pplSession.incorrect}</p><button class="fc-btn fc-btn-restart" onclick="window._pplRestart()">New Session</button></div>`;
        }
        return;
    }
    const person = pplDeck[pplIdx];
    area.innerHTML = `
        <div class="fc-card-wrap">
            <div class="fc-card ${pplFlipped ? 'flipped' : ''}" onclick="window._pplFlip()" style="min-height:360px;">
                <div class="fc-face fc-front" style="justify-content:center;">
                    <div class="fc-label">${pplIdx + 1} of ${pplDeck.length}</div>
                    <img src="${person.photo}" class="person-photo" onerror="this.src='${noPhoto}'">
                    <div class="fc-hint">Who is this? Tap to reveal</div>
                </div>
                <div class="fc-face fc-back" style="justify-content:center;">
                    <img src="${person.photo}" class="person-photo" onerror="this.src='${noPhoto}'">
                    <div class="ppl-name">${person.name}</div>
                    <div class="ppl-title">${person.title}</div>
                    <div class="ppl-cat-badge">${person.cat}</div>
                </div>
            </div>
        </div>
        <div class="fc-controls">
            ${pplFlipped ? `<button class="fc-btn fc-btn-again" onclick="window._pplMark(false)">Again</button><button class="fc-btn fc-btn-good" onclick="window._pplMark(true)">Got it</button>` : `<button class="fc-btn fc-btn-flip" onclick="window._pplFlip()">Reveal</button>`}
        </div>`;
}

window._pplFlip = () => { pplFlipped = !pplFlipped; renderPpl(); };
window._pplMark = (correct) => {
    const person = pplDeck[pplIdx];
    const p = pplProgress[person.id];
    if (correct) { p.level = Math.min(5, p.level + 1); pplSession.correct++; }
    else { p.level = Math.max(0, p.level - 1); pplSession.incorrect++; }
    p.nextReview = getNextReview(p.level); p.lastReview = Date.now();
    localStorage.setItem('pennington-people', JSON.stringify(pplProgress));
    pplIdx++; pplFlipped = false; renderPpl();
};
window._pplRestart = () => { buildPplDeck(); renderPpl(); };

// ═══════════════════════════════════════
// INITIALIZE
// ═══════════════════════════════════════
renderBriefing();
renderContext();
buildFCFilters();
connectFirebase();
initPpl();
buildPplFilters();
buildPplDeck();
renderPpl();

</script>
</body>
</html>
